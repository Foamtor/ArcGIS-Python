title: 镶嵌数据集工具小结（七）色彩平衡与接缝线 Ⅰ
categories:
  - 木工开物
date: 2014-11-17 11:38:05
tags: [Raster,Geodata]
---

镶嵌数据集的色彩平衡与接缝线  Ⅰ

![](http://img.blog.csdn.net/20141111154935774)

<br>

**色彩平衡**

镶嵌数据集一般由多张影像组成的，各幅影像可能由于各种原因存在色彩差异，例如航摄时的天气、光线等原因。为了让整个镶嵌数据集看起来是无缝的一整张，而不是一片一片的，我们需要做的就是色彩校正，或者叫做色彩平衡（均衡）。也就是实现下面的效果：

![](http://img.blog.csdn.net/20141112153456546?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2lraXRhTW9vbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

> 做色彩校正之前，需要检查原始数据的所有波段是不是满足下面几个条件：
> 
> - 所有波段已经创建统计值（包括直方图）；
> - 所有栅格数据集具有相同的波段数；
> - 所有栅格数据集的像素类型和像素深度都相同（只支持 8 位无符号和 16 位无符号位深度）；
> - 所有栅格数据集都没有关联的色彩映射表。

<br>

<br>

# **Color Balance Mosaic Dataset** 工具用于实现镶嵌数据集的色彩平衡。



## **Balance Method**

工具提供了三种匀色的算法：

**匀光/Dodging**

这是传统的匀光摄影测量方法。 如果选择“匀光/Dodging”，需要同时选择**目标颜色表面类型** 。此方法会参照目标颜色来更改每个像素值，使图像均匀过渡到目标颜色。多数情况下，匀光平衡效果最佳。

- SINGLE_COLOR  — 所有像素都参照一个单色点（即，平均值）进行匀光处理。
- COLOR_GRID    — 所有像素都参照分布在整个镶嵌数据集中的多组点进行匀光处理。
- FIRST_ORDER   — 所有像素都参照从二维多项式倾斜平面获取的多个点进行匀光处理。与“颜色格网”表面相似。                           
- SECOND_ORDER  — 所有像素都参照从二维多项式抛物线/双曲线/椭圆表面获取的一组多点进行匀光处理。与“颜色格网”表面相似。
- THIRD_ORDER   — 所有像素都参照从三次表面获取的多个点进行匀光处理。

PS：

- 当栅格数量较少且地物类型较少时，单色表面会取得良好的效果。如果栅格数据较多或者地物类型较多时，这种方法输出颜色可能会变得模糊。
- 如果有大量的栅格或区域含有大量的地面物体类型，这种方法会产生非常好的输出效果。
- First Order，Second Order, Third Oder 这三种方法与“颜色格网”表面相比，多项式阶表面的颜色变化通常更为平滑，并且使用的辅助表存储空间更少，但往往需要花费更长的时间进行处理。



**直方图/Histogram**

此方法将根据目标直方图更改各像素值。可基于所有栅格自动计算目标直方图，也可以指定一个目标栅格。
当镶嵌数据集中的所有栅格的直方图形状都相似时，直方图平衡会取得较好的效果。



**标准差/Standard Deviation**

此方法将根据标准差计算更改每个像素值。可基于所有栅格或指定的目标栅格自动计算标准差值。
当镶嵌数据集中的所有栅格的正态值具有相同的直方图分布时，标准差平衡的效果最好。



## **Target Raster**

上面三种方法中所使用到的数值，既可以来源于镶嵌数据集自身，也可以来源于自己指定的目标栅格。

不同的色彩平衡方法：

- 使用匀光平衡时，得出的目标颜色取决于当时所选择的目标颜色表面类型。
 - 对于 SINGLE_COLOR，将使用参照目标图像的平均值。
 - 对于 COLOR_GRID，会将参照目标图像重采样为适合的格网。
 - 对于 多项式阶表面，通过最小二乘拟合从参照目标图像获得多项式的系数。
- 使用直方图平衡时，将基于参照目标图像获得目标直方图。
- 使用标准差平衡时，将基于参照目标图像获得目标标准差。


## **Block Filed**

从镶嵌数据集的属性表中指定一个用于“分组”的字段，在执行计算和操作时，用于标识应被视为单一项目的多个项目。


<br>
<br>


**预处理选项**

![](http://img.blog.csdn.net/20141113163456859)

在执行栅格数据集色彩平衡之前，工具会先执行预处理选项。


# **Exclude Area Raster **

用于排除不能或者难于进行色彩校正的区域，例如：水、云和异常区域等。本质上就是创建一个掩膜，从而从镶嵌数据集色彩校正算法中排除一些像素。

PS： 对镶嵌数据集进行色彩校正时，排除区域并不会经常用到。只有当存在较难校正的区域，且不希望因为这些问题区域产生偏差时，可创建排除区域。另外，像素分布中的极值（极低像素值和极高像素值）区域也可能成为色彩校正的问题区域。

![](http://img.blog.csdn.net/20141113165004331)

那如何生成这个排除区域栅格呢？

工具箱中提供 **Generate Exclude Area** 工具，下面就来看看这个工具。

![](http://img.blog.csdn.net/20141113170331149)




通过输入数据选择 **位深** 和 **生成** 方法：

**Pixel type：**

此参数用于选择输入栅格数据集的像素深度。像素深度非常重要，因为需要对所有 8 位以上的像素深度调整色彩掩膜和直方图值。

- 8_BIT  —  0 到 255 之间。这是默认值；
- 11_BIT —  0 到 2047 之间；
- 12_BIT —  0 到 4095 之间；
- 16_BIT —  0 到 65535 之间。

**Generate Method：**

提供了两种方法：COLOR_MASK ，HISTOGRAM_PERCENTAGE

- COLOR_MASK — 可以设置要在输出中排除的最大颜色值。这是默认设置。
- HISTOGRAM_PERCENTAGE — 可以设置像素的最小和最大直方图百分比。

**Stretch Type**

如果我们指定的了拉伸类型，那么就意味着在色彩平衡的过程中，使用的是栅格数据拉伸后的值，而不是栅格数据的原始像元值。

- NONE — 不应用预拉伸。这是默认设置。
- ADAPTIVE — 自适应预拉伸。
- MINIMUM_MAXIMUM — 最小值-最大值预拉伸。
- STANDARD_DEVIATION — 标准差预拉伸。

**Gamma**

当选择了标准差拉伸或最小值-最大值拉伸时，可以额外的设置Gamma值。可通过应用 Gamma 拉伸来控制图像的整体亮度。
如果 Gamma 系数设置得太低，中间色调将太暗；而如果 Gamma 系数设置得太高，中间色调又会太亮。Gamma 系数不仅会改变图像的亮度，还会改变红绿蓝之间的比率。


如果对色彩校正的不满意，我们也可以移除效果，镶嵌数据集的右键菜单中，Remove -- Color Balancing。

![](http://img.blog.csdn.net/20141114142857968)